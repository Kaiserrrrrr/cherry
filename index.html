<!DOCTYPE html>
<html>
<head>
    <title>cherry.js</title>
    
    <script>

        // --- 2. TOGGLE LOGIC (Global Scope Safe) ---
        const urlParams = new URLSearchParams(window.location.search);
        
        // We attach this to 'window' to prevent ReferenceErrors in other scripts
        window.cherryEnabled = urlParams.get('cherry') === 'true';

        if (window.cherryEnabled) {
            const s = document.createElement('script');
            // Root-relative path to your script
            s.src = "dist/cherry.js"; 
            document.head.appendChild(s);
        }
    </script>

    <style>
        body { 
            background: #ffffff; 
            color: #d1d1d1; 
            font-family: serif; 
            margin: 0; 
            padding-bottom: 150px; 
        }
        
        /* The Control Panel UI */
        #demo-hud {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #111;
            color: #fff;
            padding: 20px;
            border-top: 5px solid #ff0000;
            font-family: sans-serif;
            z-index: 99999;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }

        .hud-btn {
            background: #ff0000;
            color: white;
            border: none;
            padding: 12px 24px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            margin-top: 10px;
        }

        /* VIOLATION: Layout Shift Trigger */
        /* Forces the browser to guess the height, causing massive jumps */
        .cls-trigger {
            width: 100%;
            height: auto;
            display: block;
            border: 5px solid #ff0000;
        }

        /* VIOLATION: Tiny Touch Targets */
        .tiny-btn {
            width: 8px;
            height: 8px;
            padding: 0;
            border: none;
            background: red;
        }
    </style>
</head>
<body>

    <div id="demo-hud">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div>
                <strong>CHERRY STATUS: </strong>
                <span id="hud-status" style="color: #ff0000; font-weight:bold;">INACTIVE</span>
            </div>
            <button id="hud-toggle" class="hud-btn">ENABLE PATCH</button>
        </div>
    </div>

    <main>
        <section>
            <h2>Performance: Cumulative Layout Shift</h2>
            <p>The image below has no dimensions. It will push content down explicitly.</p>
            <img src="https://upload.wikimedia.org/wikipedia/commons/3/3f/JPEG_example_flower.jpg" class="cls-trigger">
        </section>

        <section>
            <h2>Accessibility: Critical Failures</h2>
            
            <p>1. Tabindex Abuse (Breaks Keyboard Nav):</p>
            <button tabindex="5">I trap focus (Index 5)</button>
            <button tabindex="1">I hijack focus (Index 1)</button>

            <p>2. Duplicate IDs (Invalid HTML):</p>
            <input type="text" id="bad-id" placeholder="Input A (ID: bad-id)">
            <input type="text" id="bad-id" placeholder="Input B (ID: bad-id)">

            <p>3. Missing Labels & Tiny Targets:</p>
            <input type="checkbox"> <span>Agree to nothing</span>
            <br><br>
            <button class="tiny-btn" title="Invisible Action"></button>
        </section>

        <section>
            <h2>Best Practices & Security</h2>
            
            <p>Unsafe External Links:</p>
            <a href="https://example.com" target="_blank">Open Unsafe Link</a>

            <p>Invalid DOM Nesting:</p>
            <ul>
                <div style="padding:10px; background:#333;">Illegal DIV inside UL</div>
                <li>Valid List Item</li>
            </ul>
        </section>
    </main>

    <script>
        // --- 3. UI CONTROLLER (Bug-Free) ---
        const btn = document.getElementById('hud-toggle');
        const status = document.getElementById('hud-status');
        const hud = document.getElementById('demo-hud');

        // Check the global state we set in the <head>
        if (window.cherryEnabled) {
            status.innerText = "ACTIVE";
            status.style.color = "#00ff00";
            hud.style.borderTopColor = "#00ff00";
            btn.innerText = "DISABLE & BREAK PAGE";
            btn.style.backgroundColor = "#00ff00";
            btn.style.color = "#000";
        }

        btn.onclick = () => {
            const url = new URL(window.location.href);
            if (window.cherryEnabled) {
                url.searchParams.delete('cherry');
            } else {
                url.searchParams.set('cherry', 'true');
            }
            window.location.href = url.href;
        };
    </script>
</body>
</html>
