<!DOCTYPE html>
<html>
<head>
    <title>cherry.js | Demo</title>
    
    <style>
        /* A11y: Contrast so bad it's almost invisible */
        body { background: #fff; color: #f2f2f2; font-family: "Times New Roman"; margin: 0; }
        
        /* Layout Shift: Force a massive jump after 2 seconds */
        .shift-box { width: 100%; height: 0; background: red; transition: height 2s; }
        
        /* Dashboard Styling */
        #demo-ui { background: #000; color: #fff; padding: 20px; position: fixed; bottom: 0; width: 100%; z-index: 9999; }
        
        /* Best Practises: Fixed position elements that overlap content */
        .overlay { position: fixed; top: 0; left: 0; width: 50px; height: 50px; background: rgba(0,0,0,0.1); pointer-events: none; }
    </style>

    <script>
        const params = new URLSearchParams(window.location.search);
        const active = params.get('cherry') === 'true';

        if (active) {
            const s = document.createElement('script');
            s.src = "dist/cherry.js";
            document.head.appendChild(s);
        } else {
            const start = Date.now();
            while (Date.now() - start < 500) { 
        }
    </script>
</head>
<body>

    <div id="demo-ui">
        <strong>CHERRY ENGINE: <span id="st" style="color:red">OFF</span></strong> | 
        <button id="tg" style="cursor:pointer">ACTIVATE PATCH</button>
    </div>

    <div class="overlay"></div>

    <main>
        <section>
            <h2>Performance: The Shift & The Jank</h2>
            <img src="https://upload.wikimedia.org/wikipedia/commons/3/3f/JPEG_example_flower.jpg" style="width:100%; height:auto;">
            <p>This text will be pushed off the screen when the image above loads because there are no height attributes.</p>
        </section>

        <section>
            <h2>Accessibility: The Barrier</h2>
            <button tabindex="5">I break the tab order</button>
            <button tabindex="1">I am first but at the bottom</button>
            
            <p>Hidden form fields with no IDs:</p>
            <input type="text" placeholder="Invisible Label">
            
            <p>Tiny Hit Targets:</p>
            <a href="#" style="font-size: 5px; display: inline-block;">Small Link</a>
        </section>

        <section>
            <h2>Best Practises: Security & Trust</h2>
            <a href="https://example.com" target="_blank">Unsafe Cross-Origin Link</a>

            <script>
                if(!active) {
                    document.write('<meta http-equiv="refresh" content="300">');
                }
            </script>
        </section>

        <section>
            <h2>Structure: Invalid DOM</h2>
            <ul>
                <p>I am a paragraph. I don't belong in a UL.</p>
                <li>I'm just a lonely LI.</li>
            </ul>
        </section>
    </main>

    <script>
        const btn = document.getElementById('tg');
        if (active) {
            document.getElementById('st').innerText = "ON";
            document.getElementById('st').style.color = "#00ff00";
            btn.innerText = "DEACTIVATE";
        }
        btn.onclick = () => {
            const u = new URL(window.location.href);
            active ? u.searchParams.delete('cherry') : u.searchParams.set('cherry', 'true');
            window.location.href = u.href;
        };
    </script>
</body>
</html>
