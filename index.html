<!DOCTYPE html>
<html>
<head>
    <title>cherry.js | demo</title>
    
    <script>
        (function() {
            const start = Date.now();
            while (Date.now() - start < 500) { 
            console.warn("⚠️ Toxic Script: 500ms Main Thread Block.");
        })();

        const urlParams = new URLSearchParams(window.location.search);
        const cherryIsActive = urlParams.get('cherry') === 'true';

        if (cherryIsActive) {
            const s = document.createElement('script');
            s.src = "dist/cherry.js"; 
            document.head.appendChild(s);
        }
    </script>

    <style>
        body { color: #f0f0f0; background: #fff; font-family: serif; margin: 0; padding-bottom: 120px; }
        
        #cherry-ui { 
            position: fixed; bottom: 0; width: 100%; background: #1a1a1a; 
            color: #fff; padding: 25px; border-top: 6px solid #ff3e3e; z-index: 9999;
            font-family: sans-serif;
        }
        .btn { padding: 12px 24px; cursor: pointer; font-weight: bold; border: none; border-radius: 4px; }
        .btn-off { background: #ff3e3e; color: white; }
        .btn-on { background: #2ecc71; color: white; }
        
        .toxic-img { width: 100%; height: auto; display: block; border: 5px solid #ff3e3e; }
    </style>
</head>
<body>

    <div id="cherry-ui">
        <strong>CHERRY STATE: <span id="status-text" style="color:#ff3e3e">OFF</span></strong>
        <br><br>
        <button id="toggle-btn" class="btn btn-off">Enable Cherry Patch</button>
    </div>

    <main>
        <section>
            <h2>Performance: Massive CLS</h2>
            <p>These images lack width/height. They will push the entire page down mid-load.</p>
            <img src="https://upload.wikimedia.org/wikipedia/commons/3/3f/JPEG_example_flower.jpg" class="toxic-img">
            <img src="https://picsum.photos/id/237/1200/800" class="toxic-img">
        </section>

        <section>
            <h2>Accessibility: The Red Zone</h2>
            <button tabindex="2">I break focus flow</button>
            <button tabindex="1">I hijack focus</button>
            
            <p>Form fields with no labels (A11y Error):</p>
            <input type="text" placeholder="Username...">
            
            <p>Tiny Hit Target (A11y Error):</p>
            <button style="width:4px; height:4px; padding:0; background:red;" title="Invisible Button"></button>
        </section>

        <section>
            <h2>Best Practices & SEO</h2>
            <a href="https://example.com" target="_blank">External Link (Unsafe)</a>

            <ul>
                <div style="padding:10px; background:#ffebee;">Illegal Div inside UL</div>
                <li>Valid List Item</li>
            </ul>
        </section>
    </main>

    <script>
        const btn = document.getElementById('toggle-btn');
        const txt = document.getElementById('status-text');
        const ui = document.getElementById('cherry-ui');

        if (cherryIsActive) {
            txt.innerText = "ON";
            txt.style.color = "#2ecc71";
            ui.style.borderTopColor = "#2ecc71";
            btn.innerText = "OFF";
            btn.className = "btn btn-on";
        }

        btn.onclick = () => {
            const u = new URL(window.location.href);
            if (cherryIsActive) {
                u.searchParams.delete('cherry');
            } else {
                u.searchParams.set('cherry', 'true');
            }
            window.location.href = u.href;
        };
    </script>
</body>
</html>
